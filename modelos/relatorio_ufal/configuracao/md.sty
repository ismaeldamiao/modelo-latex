\RequirePackage{markdown}

\makeatletter
\newcommand{\customurl}[2]{
   \ifthenelse{\equal{#1}{#2}}%
   {\url{#1}}%
   {\href{#1}{#2}}%
}
\makeatother

\makeatletter
\markdownSetup{
   smartEllipses,
   fencedCode,
   citations,
   inlineFootnotes,
   headerAttributes,
   pipeTables,
   tableCaptions,
   underscores=false,
   hybrid,
   renderers = {
      link = {\customurl{#2}{#1}},
   },
   rendererPrototypes = {
      blockQuoteBegin = {\begin{citacao}},
      blockQuoteEnd   = {\end{citacao}},
      ulBegin         = {\begin{itemize}[nosep]},
      ulEnd           = {\end{itemize}},
      olBegin         = {\begin{enumerate}[nosep]},
      olEnd           = {\end{enumerate}},
      image           = {
         \begin{figure}[H]
            \caption{#4}
            \begin{center}
               \includegraphics{#2}
            \end{center}
            \legend{~}
            \label{fig:#1}
         \end{figure}
      },
      inputFencedCode = {
         \ifx\relax#2\relax
            \VerbatimInput{#1}
         \else
            \lstinputlisting[style=#2]{#1}
         \fi
      },
   },
}
\makeatother
